<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Send Dimitris a secret</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon"/>

    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->
    <link rel="stylesheet" media="screen" href="landing.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="jsencrypt.min.js" integrity="sha512-zDvrqenA0eFJZCxBsryzUZcvihvNlEXbteMv62yRxdhR4s7K1aaz+LjsRyfk6M+YJLyAJEuuquIAI8I8GgLC8A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script> -->


    <style>
        header {background-color: brown;}
        main{padding: 20px}
        input,textarea{display:block;width: 100%;}
        textarea {resize: none}
    </style>
</head>
<body>

        
	<header >
		<div class="center"> 
			<a href="/">
                <img src="https://lh3.googleusercontent.com/a-/AOh14GgNSEq1Zp7vNLUscaEcvEXWOEWQpLybI5YU1dBCMA" height="200px"/>
                <h2>Dimitris Vainanidis</h2>
                <h1>Send me a secret message!</h1>
            </a>
		</div>
	</header>
    
    <main class="container m-5">

        <label for="plainInput" class="form-label">Type your secret message here</label>
        <textarea id="plainInput" class="form-control" rows="2"></textarea>
        <br>
        <form action="/send" method="post">
            <!-- <label for="sender" class="form-label">Optionally, type your first name or something that identifies you (unencrypted)</label>
            <input id="sender" class="form-control" name="sender">
            <br> -->
            <label for="antiSpamInput" class="form-label">Type the anti-spam phrase that I gave you</label>
            <input id="antiSpamInput" class="form-control" name="antispam">
            <br>
            <label for="encryptedArea" class="form-label">This is the text that will be transmitted via the internet:</label>
            <textarea id="encryptedArea" class="form-control" rows="3" name="message" readonly required></textarea>
            <br>
            <div class="center-content"><button type="submit" class="purple" id="submitMessage" disabled>Send the message</button></div>

        </form>
        
        <hr>
        <p><small>Encryption algorithm: RSA, implemented by <a href="https://github.com/travist/jsencrypt" target="_blank">travist / jsencrypt</a></small><br/>
            <small>Decryption algorithm: RSA, implemented by <a href="https://nodejs.org/api/crypto.html" target="_blank">crypto </a>(node.js package)</small></p>
            <p>Â©2021 Dimitris Vainanidis</p>
        <br>

        <div id="testinput"></div>
    </main>


<script>
$(window).on('load',function(){

    let publicKey = 'initial value';
    let encryptedText = '';
    var encrypt = new JSEncrypt();

    //get current public key from server
    $.get('/publicKey',function(key){      
        publicKey=key;
        encrypt.setPublicKey(publicKey);
        console.debug({publicKey});
    });

    $('#plainInput').on('input',function(){   //not arrow, so this = plainInput
        if (this.value.length>1) {
            let encryptedText = encrypt.encrypt(this.value);
            if (encryptedText == false) {       //some error
                $('#encryptedArea').val("encryption error - try to send a smaller message");
                $('#plainInput').css('border-color', 'red').css('background-color', 'orange');
            } else {        //allright
                $('#encryptedArea').val(encryptedText);
                $('#plainInput').css('border-color', "").css('background-color', ""); //not null!
                $('#submitMessage').prop("disabled",false); 
            }
        } else {    //too small message
            $('#encryptedArea').val("");
            $('#plainInput').css('border-color', "").css('background-color', "");   //not null!
            $('#submitMessage').prop("disabled",true); 
        }
    });

});
</script>


</body>
</html>